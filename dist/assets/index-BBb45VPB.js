import{r as i,d as se,e as ae}from"./vendor-7H_ri9Qc.js";import{L as M,u as ne,a as re,c as le,R as oe}from"./router-B1lO67q_.js";import{L as ce}from"./maps-D4N_bm56.js";import{E as ie,a as de}from"./export-B0U_BY1P.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function u(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(t){if(t.ep)return;t.ep=!0;const n=u(t);fetch(t.href,n)}})();var Q={exports:{}},B={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ue=i,pe=Symbol.for("react.element"),he=Symbol.for("react.fragment"),me=Object.prototype.hasOwnProperty,fe=ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ge={key:!0,ref:!0,__self:!0,__source:!0};function X(o,a,u){var r,t={},n=null,c=null;u!==void 0&&(n=""+u),a.key!==void 0&&(n=""+a.key),a.ref!==void 0&&(c=a.ref);for(r in a)me.call(a,r)&&!ge.hasOwnProperty(r)&&(t[r]=a[r]);if(o&&o.defaultProps)for(r in a=o.defaultProps,a)t[r]===void 0&&(t[r]=a[r]);return{$$typeof:pe,type:o,key:n,ref:c,props:t,_owner:fe.current}}B.Fragment=he;B.jsx=X;B.jsxs=X;Q.exports=B;var e=Q.exports,G={},H=se;G.createRoot=H.createRoot,G.hydrateRoot=H.hydrateRoot;const J={lat:40.4168,lng:-3.7038},xe=3e3,je=[{label:"Any",value:""},{label:"Cafe",value:"cafe"},{label:"Pharmacy",value:"pharmacy"},{label:"Gas Station",value:"gas_station"},{label:"Restaurant",value:"restaurant"},{label:"Bakery",value:"bakery"},{label:"Book Store",value:"book_store"},{label:"Clothing Store",value:"clothing_store"},{label:"Convenience Store",value:"convenience_store"},{label:"Dentist",value:"dentist"},{label:"Doctor",value:"doctor"},{label:"Electrician",value:"electrician"},{label:"Gym",value:"gym"},{label:"Hair Care",value:"hair_care"},{label:"Hardware Store",value:"hardware_store"},{label:"Laundry",value:"laundry"},{label:"Locksmith",value:"locksmith"},{label:"Pet Store",value:"pet_store"},{label:"Shoe Store",value:"shoe_store"},{label:"Supermarket",value:"supermarket"},{label:"Veterinary Care",value:"veterinary_care"}];function ye({onResults:o}){const a=i.useRef(null),u=i.useRef(null),r=i.useRef(null),t=i.useRef(null),n=i.useRef(null),[c,m]=i.useState(xe),[f,l]=i.useState(""),[g,y]=i.useState(!1),[p,w]=i.useState(null),x=i.useMemo(()=>{const h="AIzaSyD1WeJQ9GQ4tevXW517lMnn730WQ3cTjqE";return new ce({apiKey:h,version:"weekly",libraries:["places"]})},[]);i.useEffect(()=>{let h=null,v=null;return x.importLibrary("maps").then(async()=>{const{Map:I}=await google.maps.importLibrary("maps"),{Marker:S}=await google.maps.importLibrary("marker");t.current=new I(a.current,{center:J,zoom:13,mapId:"DEMO_MAP_ID",disableDefaultUI:!1}),r.current=new S({map:t.current,position:J}),v=new google.maps.Circle({map:t.current,center:J,radius:c,strokeColor:"#2563eb",fillColor:"#3b82f650"}),n.current=v;const{Autocomplete:_}=await google.maps.importLibrary("places");return h=new _(u.current,{types:["geocode"],fields:["geometry","name","formatted_address"]}),h.addListener("place_changed",()=>{const b=h.getPlace();if(!b.geometry||!b.geometry.location)return;const P=b.geometry.location,L={lat:P.lat(),lng:P.lng()};t.current.panTo(L),r.current.setPosition(L),v.setCenter(L)}),()=>{var b;n.current=null,v==null||v.setMap(null),(b=r.current)==null||b.setMap(null)}}).catch(I=>w(String(I))),()=>{}},[x,c]),i.useEffect(()=>{n.current&&n.current.setRadius(c)},[c]);async function C(){var h,v,I,S,_,b,P,L,O,s;if(w(null),!!t.current){y(!0);try{const d=((h=r.current)==null?void 0:h.getPosition())??t.current.getCenter(),N={lat:d.lat(),lng:d.lng()},{PlacesService:E}=await google.maps.importLibrary("places"),k=new E(t.current);async function ee(){const R=[];return await new Promise((j,T)=>{const F={location:N,radius:c,type:f||void 0},W=(z,$,q)=>{if($===google.maps.places.PlacesServiceStatus.OK&&z){if(R.push(...z),q&&q.hasNextPage){setTimeout(()=>q.nextPage(),1500);return}j(R)}else $===google.maps.places.PlacesServiceStatus.ZERO_RESULTS?j([]):T(new Error(`Places search failed: ${$}`))};k.nearbySearch(F,W)})}const te=await ee(),V=[];for(const R of te){if(!R.place_id)continue;const j=await new Promise(T=>{k.getDetails({placeId:R.place_id,fields:["place_id","name","formatted_address","geometry.location","website","formatted_phone_number","url","types"]},(F,W)=>{W===google.maps.places.PlacesServiceStatus.OK?T(F):T(null)})});j&&V.push({id:j.place_id,name:j.name||R.name||"Unknown",address:j.formatted_address||R.vicinity||"",location:{lat:((I=(v=j.geometry)==null?void 0:v.location)==null?void 0:I.lat())??((_=(S=R.geometry)==null?void 0:S.location)==null?void 0:_.lat())??0,lng:((P=(b=j.geometry)==null?void 0:b.location)==null?void 0:P.lng())??((O=(L=R.geometry)==null?void 0:L.location)==null?void 0:O.lng())??0},phone:j.formatted_phone_number||void 0,website:j.website||void 0,googleMapsUrl:j.url||void 0,type:(s=j.types)==null?void 0:s[0]})}o(V)}catch(d){w(d.message||String(d))}finally{y(!1)}}}return e.jsxs("div",{className:"map-search",children:[e.jsxs("div",{className:"controls",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Location"}),e.jsx("input",{ref:u,placeholder:"Type a city, address, or area"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Business Type"}),e.jsx("select",{value:f,onChange:h=>l(h.target.value),children:je.map(h=>e.jsx("option",{value:h.value,children:h.label},h.label))})]}),e.jsxs("div",{className:"field",children:[e.jsxs("label",{children:["Radius: ",(c/1e3).toFixed(1)," km"]}),e.jsx("input",{type:"range",min:500,max:1e4,step:500,value:c,onChange:h=>m(Number(h.target.value))})]}),e.jsx("button",{className:"primary",onClick:C,disabled:g,children:g?"Searching…":"Search"})]}),p&&e.jsx("div",{className:"error",children:p}),e.jsx("div",{ref:a,className:"map"})]})}function ve(o){try{const a=`note:${o}`;return!!localStorage.getItem(a)}catch{return!1}}function be({results:o}){const[a,u]=i.useState("name"),[r,t]=i.useState(!0),[n,c]=i.useState({});i.useEffect(()=>{const l=()=>{const y={};o.forEach(p=>{y[p.id]=ve(p.id)}),c(y)};l(),window.addEventListener("storage",l);const g=setInterval(l,1e3);return()=>{window.removeEventListener("storage",l),clearInterval(g)}},[o]);const m=i.useMemo(()=>{const l=[...o];return l.sort((g,y)=>{const p=(g[a]||"").toString().toLowerCase(),w=(y[a]||"").toString().toLowerCase();return p<w?r?-1:1:p>w?r?1:-1:0}),l},[o,a,r]);function f(l){l===a?t(!r):(u(l),t(!0))}return e.jsxs("div",{className:"results-table",children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>f("name"),children:"Name"}),e.jsx("th",{onClick:()=>f("address"),children:"Address"}),e.jsx("th",{onClick:()=>f("phone"),children:"Phone"}),e.jsx("th",{onClick:()=>f("website"),children:"Website"}),e.jsx("th",{children:"Maps"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:m.map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:l.name}),e.jsx("td",{children:l.address}),e.jsx("td",{children:l.phone||"—"}),e.jsx("td",{children:l.website?e.jsx("a",{href:l.website,target:"_blank",rel:"noreferrer",children:new URL(l.website).hostname}):e.jsx("span",{className:"badge",children:"No website"})}),e.jsx("td",{children:l.googleMapsUrl?e.jsx("a",{href:l.googleMapsUrl,target:"_blank",rel:"noreferrer",children:"Open"}):e.jsx("a",{href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(l.name+" "+l.address)}`,target:"_blank",rel:"noreferrer",children:"Open"})}),e.jsx("td",{children:n[l.id]?e.jsx("span",{className:"badge",style:{backgroundColor:"rgba(34, 211, 238, 0.2)",color:"var(--accent)"},children:"Has note"}):e.jsx(M,{className:"ghost",to:`/notes?placeId=${encodeURIComponent(l.id)}&name=${encodeURIComponent(l.name)}&address=${encodeURIComponent(l.address)}`,children:"Add note"})})]},l.id))})]}),m.length===0&&e.jsx("div",{className:"empty",children:"No results yet."})]})}function A(o){const a=(o??"").toString();return a.includes(",")||a.includes('"')||a.includes(`
`)?'"'+a.replace(/"/g,'""')+'"':a}function we({data:o}){function a(){const r=["Name","Phone","Address","Website","Latitude","Longitude"],t=o.map(l=>[A(l.name),A(l.phone||""),A(l.address),A(l.website||""),A(l.location.lat),A(l.location.lng)]),n=[r.join(","),...t.map(l=>l.join(","))].join(`
`),c=new Blob([n],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(c),f=document.createElement("a");f.href=m,f.download="client-finder-results.csv",f.click(),URL.revokeObjectURL(m)}function u(){const r=new ie({orientation:"landscape"});r.text("Client Finder Results",14,14),de(r,{head:[["Name","Phone","Address","Website"]],body:o.map(t=>[t.name,t.phone||"",t.address,t.website?new URL(t.website).hostname:"—"]),styles:{fontSize:8},startY:20,columnStyles:{0:{cellWidth:60},1:{cellWidth:35},2:{cellWidth:120},3:{cellWidth:60}}}),r.save("client-finder-results.pdf")}return e.jsxs("div",{className:"export-buttons",children:[e.jsx("button",{className:"ghost",onClick:a,disabled:o.length===0,children:"Export CSV"}),e.jsx("button",{className:"ghost",onClick:u,disabled:o.length===0,children:"Export PDF"})]})}function Se(){const o=ne(),[a,u]=i.useState([]),[r,t]=i.useState(!1),n=i.useMemo(()=>r?a.filter(c=>!c.website):a,[a,r]);return e.jsxs("div",{className:"app",children:[e.jsx("header",{className:"app-header",children:e.jsxs("div",{className:"header-row",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Client Finder"}),e.jsx("p",{children:"Find local businesses with missing websites."})]}),e.jsxs("nav",{className:"header-nav",children:[e.jsx(M,{className:o.pathname==="/"?"active":"",to:"/",children:"Search"}),e.jsx(M,{className:o.pathname==="/notes"?"active":"",to:"/notes",children:"Notes"})]})]})}),e.jsxs("main",{className:"container",children:[e.jsx("section",{className:"card",children:e.jsx(ye,{onResults:u})}),e.jsxs("section",{className:"card",children:[e.jsxs("div",{className:"table-toolbar",children:[e.jsxs("label",{className:"checkbox",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:c=>t(c.target.checked)}),e.jsx("span",{children:"Show only businesses without website"})]}),e.jsx(we,{data:n})]}),e.jsx(be,{results:n})]})]}),e.jsx("footer",{className:"footer",children:"Powered by Google Maps Places"})]})}function Ne(){return typeof window<"u"&&window.location.hostname==="localhost"}const Z="notes:index";function K(){try{return JSON.parse(localStorage.getItem(Z)||"[]")}catch{return[]}}function Y(o){localStorage.setItem(Z,JSON.stringify(o))}function U(o){return`note:${o}`}async function D(o,a){if(!Ne()){const t=await fetch(o,{...a,headers:{"Content-Type":"application/json",...(a==null?void 0:a.headers)||{}}}),n=t.headers.get("Content-Type")||"";if(t.ok&&n.includes("application/json"))return t.json();if(!(t.ok&&!n.includes("application/json"))){if(!t.ok)throw new Error(await t.text())}}const u=new URL(o,window.location.origin),r=((a==null?void 0:a.method)||"GET").toUpperCase();if(u.pathname==="/api/notes"&&r==="GET"){const t=u.searchParams.get("placeId");if(t){const m=localStorage.getItem(U(t));return m?JSON.parse(m):{}}return K().map(m=>localStorage.getItem(U(m))).filter(Boolean).map(m=>JSON.parse(m))}if(u.pathname==="/api/notes"&&r==="POST"){const t=a!=null&&a.body?JSON.parse(a.body):{};if(!t.placeId)throw new Error("placeId is required");const n={placeId:t.placeId,name:t.name||"",address:t.address||"",note:t.note||"",status:t.status||"new",updatedAt:new Date().toISOString()};localStorage.setItem(U(n.placeId),JSON.stringify(n));const c=new Set(K());return c.add(n.placeId),Y(Array.from(c)),n}if(u.pathname==="/api/notes"&&r==="DELETE"){const t=u.searchParams.get("placeId");if(!t)throw new Error("placeId is required");localStorage.removeItem(U(t));const n=K().filter(c=>c!==t);return Y(n),{ok:!0}}throw new Error("Unsupported operation in dev fallback")}function Ce(){const[o]=re(),a=o.get("placeId")||"",u=o.get("name")||"",r=o.get("address")||"",[t,n]=i.useState([]),[c,m]=i.useState(""),[f,l]=i.useState("all"),[g,y]=i.useState("updated"),[p,w]=i.useState(!1),[x,C]=i.useState({placeId:a,name:u,address:r,note:"",status:"new"}),[h,v]=i.useState(!1),[I,S]=i.useState(null);i.useEffect(()=>{_(),a&&C(s=>({...s,placeId:a,name:u,address:r}))},[]);async function _(){try{const s=await D("/api/notes");n(s)}catch(s){S(s.message||String(s))}}const b=i.useMemo(()=>{let s=[...t];if(c){const d=c.toLowerCase();s=s.filter(N=>[N.name,N.address,N.placeId,N.note].filter(Boolean).some(E=>E.toLowerCase().includes(d)))}return f!=="all"&&(s=s.filter(d=>(d.status||"new")===f)),s.sort((d,N)=>{let E="",k="";return g==="updated"?(E=new Date(d.updatedAt||0).getTime(),k=new Date(N.updatedAt||0).getTime()):g==="name"?(E=(d.name||"").toLowerCase(),k=(N.name||"").toLowerCase()):g==="status"&&(E=(d.status||"new").toLowerCase(),k=(N.status||"new").toLowerCase()),E<k?p?-1:1:E>k?p?1:-1:0}),s},[t,c,f,g,p]);async function P(){if(!x.placeId){S("Place ID is required");return}S(null),v(!0);try{await D("/api/notes",{method:"POST",body:JSON.stringify(x)}),await _()}catch(s){S(s.message||String(s))}finally{v(!1)}}async function L(s){try{const d=await D(`/api/notes?placeId=${encodeURIComponent(s)}`);C({placeId:d.placeId,name:d.name,address:d.address,note:d.note,status:d.status||"new"})}catch(d){S(d.message||String(d))}}async function O(s){try{await D(`/api/notes?placeId=${encodeURIComponent(s)}`,{method:"DELETE"}),await _()}catch(d){S(d.message||String(d))}}return e.jsxs("div",{className:"container",style:{paddingTop:24},children:[e.jsxs("div",{className:"card",style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{margin:0},children:"Notes"}),e.jsx(M,{className:"ghost",to:"/",children:"← Back to search"})]}),e.jsxs("div",{className:"controls",style:{marginTop:12,display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Search notes"}),e.jsx("input",{value:c,onChange:s=>m(s.target.value),placeholder:"Search by name, address, text"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Filter by status"}),e.jsxs("select",{value:f,onChange:s=>l(s.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"contacted",children:"Contacted"}),e.jsx("option",{value:"follow_up",children:"Follow up"}),e.jsx("option",{value:"won",children:"Won"}),e.jsx("option",{value:"lost",children:"Lost"})]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Sort by"}),e.jsxs("select",{value:g,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"updated",children:"Updated date"}),e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"status",children:"Status"})]})]}),e.jsx("div",{className:"field",style:{gridColumn:"span 3"},children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:p,onChange:s=>w(s.target.checked)}),e.jsx("span",{style:{marginLeft:8},children:"Sort ascending"})]})})]})]}),e.jsxs("div",{className:"card",style:{marginBottom:16},children:[e.jsx("h3",{style:{marginTop:0},children:"Add / Edit Note"}),e.jsxs("div",{className:"controls",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Place ID"}),e.jsx("input",{value:x.placeId,onChange:s=>C({...x,placeId:s.target.value}),placeholder:"Google place_id"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Name"}),e.jsx("input",{value:x.name||"",onChange:s=>C({...x,name:s.target.value})})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{value:x.address||"",onChange:s=>C({...x,address:s.target.value})})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:x.status,onChange:s=>C({...x,status:s.target.value}),children:[e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"contacted",children:"Contacted"}),e.jsx("option",{value:"follow_up",children:"Follow up"}),e.jsx("option",{value:"won",children:"Won"}),e.jsx("option",{value:"lost",children:"Lost"})]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Note"}),e.jsx("textarea",{style:{minHeight:100,background:"#0b1224",color:"var(--text)",border:"1px solid rgba(148, 163, 184, 0.16)",borderRadius:"10px",padding:"10px 12px",outline:"none",fontFamily:"inherit",resize:"vertical",width:"100%"},value:x.note||"",onChange:s=>C({...x,note:s.target.value})})]}),e.jsx("div",{children:e.jsx("button",{className:"primary",onClick:P,disabled:h,children:h?"Saving…":"Save note"})})]}),I&&e.jsx("div",{className:"error",style:{marginTop:10},children:I})]}),e.jsxs("div",{className:"card",children:[e.jsxs("table",{className:"notes-table",style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{style:{textAlign:"left",padding:8,cursor:"pointer"},onClick:()=>{y("name"),w(!p)},children:["Name ",g==="name"&&(p?"↑":"↓")]}),e.jsx("th",{style:{textAlign:"left",padding:8},children:"Address"}),e.jsxs("th",{style:{textAlign:"left",padding:8,cursor:"pointer"},onClick:()=>{y("status"),w(!p)},children:["Status ",g==="status"&&(p?"↑":"↓")]}),e.jsxs("th",{style:{textAlign:"left",padding:8,cursor:"pointer"},onClick:()=>{y("updated"),w(!p)},children:["Updated ",g==="updated"&&(p?"↑":"↓")]}),e.jsx("th",{style:{textAlign:"left",padding:8},children:"Actions"})]})}),e.jsx("tbody",{children:b.map(s=>e.jsxs("tr",{children:[e.jsx("td",{style:{padding:8},children:s.name||"—"}),e.jsx("td",{style:{padding:8},children:s.address||"—"}),e.jsx("td",{style:{padding:8},children:e.jsx("span",{className:"badge",style:{backgroundColor:s.status==="won"?"rgba(34, 197, 94, 0.2)":s.status==="lost"?"rgba(239, 68, 68, 0.2)":s.status==="contacted"?"rgba(59, 130, 246, 0.2)":s.status==="follow_up"?"rgba(251, 191, 36, 0.2)":"rgba(148, 163, 184, 0.2)",color:s.status==="won"?"#22c55e":s.status==="lost"?"#ef4444":s.status==="contacted"?"#3b82f6":s.status==="follow_up"?"#fbbf24":"var(--muted)"},children:s.status||"new"})}),e.jsx("td",{style:{padding:8},children:s.updatedAt?new Date(s.updatedAt).toLocaleString():"—"}),e.jsxs("td",{style:{padding:8},children:[e.jsx("button",{className:"ghost",onClick:()=>L(s.placeId),children:"Edit"}),e.jsx("button",{className:"ghost",onClick:()=>O(s.placeId),children:"Delete"})]})]},s.placeId))})]}),b.length===0&&e.jsx("div",{className:"empty",children:"No notes yet."})]})]})}const Ie=le([{path:"/",element:e.jsx(Se,{})},{path:"/notes",element:e.jsx(Ce,{})}]);G.createRoot(document.getElementById("root")).render(e.jsx(ae.StrictMode,{children:e.jsx(oe,{router:Ie})}));
